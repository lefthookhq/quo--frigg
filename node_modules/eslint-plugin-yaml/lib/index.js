"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.configs = exports.processors = void 0;
const js_yaml_1 = require("js-yaml");
const jshint_1 = require("jshint");
const fileContents = new Map();
function cacheYaml(fileName, text) {
    fileContents.set(fileName, text);
}
function loadYaml(fileContent, fileName) {
    return js_yaml_1.loadAll(fileContent, undefined, {
        filename: fileName,
        json: false,
    });
}
function lintJSON(yamlDoc) {
    var _a;
    const yaml_json = JSON.stringify(yamlDoc, null, 2);
    jshint_1.JSHINT(yaml_json);
    const data = jshint_1.JSHINT.data();
    const errors = (_a = data === null || data === void 0 ? void 0 : data.errors) !== null && _a !== void 0 ? _a : [];
    return errors;
}
function preprocess(text, fileName) {
    cacheYaml(fileName, text);
    return [{ text, filename: fileName }];
}
function postprocess(messages, fileName) {
    var _a, _b;
    let linter_messages = [];
    const fileContent = fileContents.get(fileName);
    if (fileContent !== undefined) {
        let yamlDocs;
        try {
            yamlDocs = loadYaml(fileContent, fileName);
        }
        catch (e) {
            const { message, mark } = e;
            return [
                {
                    ruleId: "invalid-yaml",
                    severity: 2,
                    message,
                    source: mark === null || mark === void 0 ? void 0 : mark.buffer,
                    line: (_a = mark === null || mark === void 0 ? void 0 : mark.line) !== null && _a !== void 0 ? _a : 0,
                    column: (_b = mark === null || mark === void 0 ? void 0 : mark.column) !== null && _b !== void 0 ? _b : 0,
                },
            ];
        }
        const errors = yamlDocs.map((yamlDoc) => lintJSON(yamlDoc)).flat();
        linter_messages = errors.map((error) => {
            const { reason, evidence, line, character } = error;
            return {
                ruleId: "bad-yaml",
                severity: 2,
                message: reason,
                source: evidence,
                line,
                column: character,
            };
        });
        fileContents.delete(fileName);
    }
    return linter_messages;
}
exports.processors = {
    ".yml": {
        preprocess,
        postprocess,
    },
    ".yaml": {
        preprocess,
        postprocess,
    },
};
exports.configs = {
    recommended: {
        ignorePatterns: ["!.github"],
        overrides: [
            {
                plugins: ["yaml"],
                files: ["*.yaml", "*.yml"],
            },
        ],
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscUNBQWlDO0FBQ2pDLG1DQUF3RTtBQVl4RSxNQUFNLFlBQVksR0FBRyxJQUFJLEdBQUcsRUFBa0IsQ0FBQTtBQUc5QyxTQUFTLFNBQVMsQ0FBQyxRQUFnQixFQUFFLElBQVk7SUFDL0MsWUFBWSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDbEMsQ0FBQztBQU9ELFNBQVMsUUFBUSxDQUFDLFdBQW1CLEVBQUUsUUFBZ0I7SUFFckQsT0FBTyxpQkFBTyxDQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUU7UUFDckMsUUFBUSxFQUFFLFFBQVE7UUFDbEIsSUFBSSxFQUFFLEtBQUs7S0FDWixDQUFDLENBQUE7QUFDSixDQUFDO0FBR0QsU0FBUyxRQUFRLENBQUMsT0FBeUI7O0lBQ3pDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUNsRCxlQUFNLENBQUMsU0FBUyxDQUFDLENBQUE7SUFDakIsTUFBTSxJQUFJLEdBQUcsZUFBTSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQzFCLE1BQU0sTUFBTSxHQUFHLE1BQUEsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLE1BQU0sbUNBQUksRUFBRSxDQUFBO0lBQ2pDLE9BQU8sTUFBTSxDQUFBO0FBQ2YsQ0FBQztBQVVELFNBQVMsVUFBVSxDQUFDLElBQVksRUFBRSxRQUFnQjtJQUNoRCxTQUFTLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFBO0lBR3pCLE9BQU8sQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQTtBQUN2QyxDQUFDO0FBR0QsU0FBUyxXQUFXLENBQUMsUUFBZ0MsRUFBRSxRQUFnQjs7SUFTckUsSUFBSSxlQUFlLEdBQXlCLEVBQUUsQ0FBQTtJQUU5QyxNQUFNLFdBQVcsR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzlDLElBQUksV0FBVyxLQUFLLFNBQVMsRUFBRTtRQUU3QixJQUFJLFFBQW1DLENBQUE7UUFDdkMsSUFBSTtZQUNGLFFBQVEsR0FBRyxRQUFRLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1NBQzNDO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxHQUFHLENBQXNCLENBQUE7WUFDaEQsT0FBTztnQkFDTDtvQkFDRSxNQUFNLEVBQUUsY0FBYztvQkFDdEIsUUFBUSxFQUFFLENBQUM7b0JBQ1gsT0FBTztvQkFDUCxNQUFNLEVBQUUsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLE1BQU07b0JBQ3BCLElBQUksRUFBRSxNQUFBLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxJQUFJLG1DQUFJLENBQUM7b0JBQ3JCLE1BQU0sRUFBRSxNQUFBLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxNQUFNLG1DQUFJLENBQUM7aUJBQzFCO2FBQ0YsQ0FBQTtTQUNGO1FBTUQsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDbEUsZUFBZSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNyQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsS0FBSyxDQUFBO1lBQ25ELE9BQU87Z0JBQ0wsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLFFBQVEsRUFBRSxDQUFDO2dCQUNYLE9BQU8sRUFBRSxNQUFNO2dCQUNmLE1BQU0sRUFBRSxRQUFRO2dCQUNoQixJQUFJO2dCQUNKLE1BQU0sRUFBRSxTQUFTO2FBQ2xCLENBQUE7UUFDSCxDQUFDLENBQUMsQ0FBQTtRQUdGLFlBQVksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7S0FDOUI7SUFHRCxPQUFPLGVBQWUsQ0FBQTtBQUN4QixDQUFDO0FBRVksUUFBQSxVQUFVLEdBQUc7SUFFeEIsTUFBTSxFQUFFO1FBQ04sVUFBVTtRQUNWLFdBQVc7S0FDWjtJQUNELE9BQU8sRUFBRTtRQUNQLFVBQVU7UUFDVixXQUFXO0tBQ1o7Q0FDRixDQUFBO0FBRVksUUFBQSxPQUFPLEdBQUc7SUFDckIsV0FBVyxFQUFFO1FBQ1gsY0FBYyxFQUFFLENBQUMsVUFBVSxDQUFDO1FBQzVCLFNBQVMsRUFBRTtZQUNUO2dCQUNFLE9BQU8sRUFBRSxDQUFDLE1BQU0sQ0FBQztnQkFDakIsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQzthQUMzQjtTQUNGO0tBQ0Y7Q0FDRixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9hZEFsbCB9IGZyb20gXCJqcy15YW1sXCJcclxuaW1wb3J0IHsgSlNISU5UIGFzIGpzaGludCwgTGludEVycm9yIGFzIEpzSGludExpbnRFcnJvcnMgfSBmcm9tIFwianNoaW50XCJcclxuaW1wb3J0IHR5cGUgeyBMaW50ZXIgfSBmcm9tIFwiZXNsaW50XCJcclxuXHJcbi8qXHJcbuKWiOKWiCAgICDilojilogg4paI4paI4paI4paI4paI4paI4paI4paIIOKWiOKWiCDilojiloggICAgICDilojilojilojilojilojilojilohcclxu4paI4paIICAgIOKWiOKWiCAgICDilojiloggICAg4paI4paIIOKWiOKWiCAgICAgIOKWiOKWiFxyXG7ilojiloggICAg4paI4paIICAgIOKWiOKWiCAgICDilojilogg4paI4paIICAgICAg4paI4paI4paI4paI4paI4paI4paIXHJcbuKWiOKWiCAgICDilojiloggICAg4paI4paIICAgIOKWiOKWiCDilojiloggICAgICAgICAgIOKWiOKWiFxyXG4g4paI4paI4paI4paI4paI4paIICAgICDilojiloggICAg4paI4paIIOKWiOKWiOKWiOKWiOKWiOKWiOKWiCDilojilojilojilojilojilojilohcclxuKi9cclxuXHJcbi8vIGZpbGVuYW1lIC0+IGZpbGVDb250ZW50XHJcbmNvbnN0IGZpbGVDb250ZW50cyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KClcclxuXHJcbi8qKiBUYWtlcyB0ZXh0IG9mIHRoZSBmaWxlIGFuZCBmaWxlbmFtZSAqL1xyXG5mdW5jdGlvbiBjYWNoZVlhbWwoZmlsZU5hbWU6IHN0cmluZywgdGV4dDogc3RyaW5nKSB7XHJcbiAgZmlsZUNvbnRlbnRzLnNldChmaWxlTmFtZSwgdGV4dClcclxufVxyXG5cclxudHlwZSBMb2FkWWFtbFZhbHVlID0gYW55W11cclxuLy8gaXQgc2VlbXMgbWFyayBjYW4gYmUgdW5kZWZpbmVkIGlzc3VlICM2N1xyXG50eXBlIExvYWRZYW1sRXhjZXB0aW9uID0geyBtZXNzYWdlOiBzdHJpbmc7IG1hcms/OiB7IGJ1ZmZlcjogc3RyaW5nOyBsaW5lOiBudW1iZXI7IGNvbHVtbjogbnVtYmVyIH0gfVxyXG5cclxuLyoqIFVzZSBqcy15YW1sIGZvciByZWFkaW5nIHRoZSB5YW1sIGZpbGUgKi9cclxuZnVuY3Rpb24gbG9hZFlhbWwoZmlsZUNvbnRlbnQ6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZyk6IExvYWRZYW1sVmFsdWUge1xyXG4gIC8vIEdldCBkb2N1bWVudCwgb3IgdGhyb3cgZXhjZXB0aW9uIG9uIGVycm9yXHJcbiAgcmV0dXJuIGxvYWRBbGwoZmlsZUNvbnRlbnQsIHVuZGVmaW5lZCwge1xyXG4gICAgZmlsZW5hbWU6IGZpbGVOYW1lLFxyXG4gICAganNvbjogZmFsc2UsXHJcbiAgfSlcclxufVxyXG5cclxuLyoqIFlBTUwgTGludCB2aWEgSlNPTiAoY29udmVydGluZyB0byBqc29uIGFuZCBsaW50aW5nIHVzaW5nIGpzaGludCkgKi9cclxuZnVuY3Rpb24gbGludEpTT04oeWFtbERvYzogTG9hZFlhbWxWYWx1ZVswXSk6IEpzSGludExpbnRFcnJvcnNbXSB7XHJcbiAgY29uc3QgeWFtbF9qc29uID0gSlNPTi5zdHJpbmdpZnkoeWFtbERvYywgbnVsbCwgMilcclxuICBqc2hpbnQoeWFtbF9qc29uKVxyXG4gIGNvbnN0IGRhdGEgPSBqc2hpbnQuZGF0YSgpXHJcbiAgY29uc3QgZXJyb3JzID0gZGF0YT8uZXJyb3JzID8/IFtdXHJcbiAgcmV0dXJuIGVycm9yc1xyXG59XHJcblxyXG4vKlxyXG7ilojilojilojilojilojilojilogg4paI4paIICAg4paI4paIIOKWiOKWiOKWiOKWiOKWiOKWiCAgIOKWiOKWiOKWiOKWiOKWiOKWiCAg4paI4paI4paI4paI4paI4paIICDilojilojilojilojilojilojilojilogg4paI4paI4paI4paI4paI4paI4paIXHJcbuKWiOKWiCAgICAgICDilojilogg4paI4paIICDilojiloggICDilojilogg4paI4paIICAgIOKWiOKWiCDilojiloggICDilojiloggICAg4paI4paIICAgIOKWiOKWiFxyXG7ilojilojilojilojiloggICAgIOKWiOKWiOKWiCAgIOKWiOKWiOKWiOKWiOKWiOKWiCAg4paI4paIICAgIOKWiOKWiCDilojilojilojilojilojiloggICAgIOKWiOKWiCAgICDilojilojilojilojilojilojilohcclxu4paI4paIICAgICAgIOKWiOKWiCDilojiloggIOKWiOKWiCAgICAgIOKWiOKWiCAgICDilojilogg4paI4paIICAg4paI4paIICAgIOKWiOKWiCAgICAgICAgIOKWiOKWiFxyXG7ilojilojilojilojilojilojilogg4paI4paIICAg4paI4paIIOKWiOKWiCAgICAgICDilojilojilojilojilojiloggIOKWiOKWiCAgIOKWiOKWiCAgICDilojiloggICAg4paI4paI4paI4paI4paI4paI4paIXHJcbiovXHJcblxyXG5mdW5jdGlvbiBwcmVwcm9jZXNzKHRleHQ6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZykge1xyXG4gIGNhY2hlWWFtbChmaWxlTmFtZSwgdGV4dClcclxuXHJcbiAgLy8gcmV0dXJuIGFuIGFycmF5IG9mIGNvZGUgYmxvY2tzIHRvIGxpbnRcclxuICByZXR1cm4gW3sgdGV4dCwgZmlsZW5hbWU6IGZpbGVOYW1lIH1dXHJcbn1cclxuXHJcbi8vIEB0cy1pZ25vcmVcclxuZnVuY3Rpb24gcG9zdHByb2Nlc3MobWVzc2FnZXM6IExpbnRlci5MaW50TWVzc2FnZVtdW10sIGZpbGVOYW1lOiBzdHJpbmcpOiBMaW50ZXIuTGludE1lc3NhZ2VbXSB7XHJcbiAgLy8gdGFrZXMgYSBNZXNzYWdlW11bXSBhbmQgZmlsZW5hbWVcclxuICAvLyBgbWVzc2FnZXNgIGFyZ3VtZW50IGNvbnRhaW5zIHR3by1kaW1lbnNpb25hbCBhcnJheSBvZiBNZXNzYWdlIG9iamVjdHNcclxuICAvLyB3aGVyZSBlYWNoIHRvcC1sZXZlbCBhcnJheSBpdGVtIGNvbnRhaW5zIGFycmF5IG9mIGxpbnQgbWVzc2FnZXMgcmVsYXRlZFxyXG4gIC8vIHRvIHRoZSB0ZXh0IHRoYXQgd2FzIHJldHVybmVkIGluIGFycmF5IGZyb20gcHJlcHJvY2VzcygpIG1ldGhvZFxyXG5cclxuICAvKlxyXG4gICAqIFlBTUwgTGludCBieSBWYWxpZGF0aW9uXHJcbiAgICovXHJcbiAgbGV0IGxpbnRlcl9tZXNzYWdlczogTGludGVyLkxpbnRNZXNzYWdlW10gPSBbXVxyXG5cclxuICBjb25zdCBmaWxlQ29udGVudCA9IGZpbGVDb250ZW50cy5nZXQoZmlsZU5hbWUpXHJcbiAgaWYgKGZpbGVDb250ZW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgIC8vIEdldCBkb2N1bWVudCwgb3IgdGhyb3cgZXhjZXB0aW9uIG9uIGVycm9yXHJcbiAgICBsZXQgeWFtbERvY3M6IExvYWRZYW1sVmFsdWUgfCB1bmRlZmluZWRcclxuICAgIHRyeSB7XHJcbiAgICAgIHlhbWxEb2NzID0gbG9hZFlhbWwoZmlsZUNvbnRlbnQsIGZpbGVOYW1lKVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zdCB7IG1lc3NhZ2UsIG1hcmsgfSA9IGUgYXMgTG9hZFlhbWxFeGNlcHRpb25cclxuICAgICAgcmV0dXJuIFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICBydWxlSWQ6IFwiaW52YWxpZC15YW1sXCIsXHJcbiAgICAgICAgICBzZXZlcml0eTogMixcclxuICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICBzb3VyY2U6IG1hcms/LmJ1ZmZlcixcclxuICAgICAgICAgIGxpbmU6IG1hcms/LmxpbmUgPz8gMCxcclxuICAgICAgICAgIGNvbHVtbjogbWFyaz8uY29sdW1uID8/IDAsXHJcbiAgICAgICAgfSxcclxuICAgICAgXVxyXG4gICAgfVxyXG4gICAgLy8gYXQgdGhpcyBwb2ludCB5YW1sRG9jcyBpcyBkZWZpbmVkXHJcblxyXG4gICAgLypcclxuICAgICAqIFlBTUwgTGludCB2aWEgSlNPTlxyXG4gICAgICovXHJcbiAgICBjb25zdCBlcnJvcnMgPSB5YW1sRG9jcy5tYXAoKHlhbWxEb2MpID0+IGxpbnRKU09OKHlhbWxEb2MpKS5mbGF0KClcclxuICAgIGxpbnRlcl9tZXNzYWdlcyA9IGVycm9ycy5tYXAoKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgcmVhc29uLCBldmlkZW5jZSwgbGluZSwgY2hhcmFjdGVyIH0gPSBlcnJvclxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHJ1bGVJZDogXCJiYWQteWFtbFwiLFxyXG4gICAgICAgIHNldmVyaXR5OiAyLFxyXG4gICAgICAgIG1lc3NhZ2U6IHJlYXNvbixcclxuICAgICAgICBzb3VyY2U6IGV2aWRlbmNlLFxyXG4gICAgICAgIGxpbmUsXHJcbiAgICAgICAgY29sdW1uOiBjaGFyYWN0ZXIsXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgLy8gZW1wdHkgY2FjaGVcclxuICAgIGZpbGVDb250ZW50cy5kZWxldGUoZmlsZU5hbWUpXHJcbiAgfVxyXG5cclxuICAvLyAvLyB5b3UgbmVlZCB0byByZXR1cm4gYSBvbmUtZGltZW5zaW9uYWwgYXJyYXkgb2YgdGhlIG1lc3NhZ2VzIHlvdSB3YW50IHRvIGtlZXBcclxuICByZXR1cm4gbGludGVyX21lc3NhZ2VzXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBwcm9jZXNzb3JzID0ge1xyXG4gIC8vIGFkZCB5b3VyIHByb2Nlc3NvcnMgaGVyZVxyXG4gIFwiLnltbFwiOiB7XHJcbiAgICBwcmVwcm9jZXNzLFxyXG4gICAgcG9zdHByb2Nlc3MsXHJcbiAgfSxcclxuICBcIi55YW1sXCI6IHtcclxuICAgIHByZXByb2Nlc3MsXHJcbiAgICBwb3N0cHJvY2VzcyxcclxuICB9LFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlncyA9IHtcclxuICByZWNvbW1lbmRlZDoge1xyXG4gICAgaWdub3JlUGF0dGVybnM6IFtcIiEuZ2l0aHViXCJdLFxyXG4gICAgb3ZlcnJpZGVzOiBbXHJcbiAgICAgIHtcclxuICAgICAgICBwbHVnaW5zOiBbXCJ5YW1sXCJdLFxyXG4gICAgICAgIGZpbGVzOiBbXCIqLnlhbWxcIiwgXCIqLnltbFwiXSxcclxuICAgICAgfSxcclxuICAgIF0sXHJcbiAgfSxcclxufVxyXG4iXX0=