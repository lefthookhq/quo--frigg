# DDD/Hexagonal Architecture Cleanup Plan

**Based on**: Existing ARCHITECTURE.md and DDD_VALIDATION_REPORT.md
**Status**: Phase 1 Complete (Infrastructure reorganized)
**Date**: 2025-09-30

## Context

The codebase already implements proper DDD/Hexagonal architecture with passing validation. However, there's **structural duplication** causing navigation confusion:

- âœ… DDD layers properly implemented (domain, application, infrastructure)
- âœ… Tests comprehensive and passing
- âœ… Architecture validated and production-ready
- âŒ **Duplicate directories**: Components, hooks, and UI exist in BOTH root `/src` and `/src/presentation`

## Current Issue: Directory Duplication

```
src/
â”œâ”€â”€ components/           âŒ DUPLICATE - 14 files
â”‚   â”œâ”€â”€ ui/              âŒ DUPLICATE - 7 files
â”‚   â””â”€â”€ *.jsx
â”œâ”€â”€ hooks/               âŒ DUPLICATE - 5 files
â”œâ”€â”€ pages/               âŒ DUPLICATE - 1 file
â”‚
â””â”€â”€ presentation/        âœ… CORRECT DDD LOCATION
    â”œâ”€â”€ components/      âœ… Some files here (DefinitionsZone, etc.)
    â”‚   â””â”€â”€ ui/         âœ… Some UI components (dialog.jsx)
    â”œâ”€â”€ hooks/          âœ… useFrigg.jsx here
    â””â”€â”€ pages/          âœ… (empty)
```

### Which Files Are Where?

**Root `/src/components/` (14 files - OLD):**
- Layout.jsx, ThemeProvider.jsx, TestAreaContainer.jsx
- TestAreaWelcome.jsx, TestAreaUserSelection.jsx
- TestingZone.jsx, IntegrationGallery.jsx
- ZoneNavigation.jsx, SearchBar.jsx, LiveLogPanel.jsx
- IDESelector.jsx, OpenInIDEButton.jsx, SettingsModal.jsx
- index.js

**Root `/src/components/ui/` (7 files - OLD):**
- button.tsx, card.tsx, badge.tsx, skeleton.jsx
- dropdown-menu.tsx, select.tsx, input.jsx

**Root `/src/hooks/` (5 files - OLD):**
- useFrigg.jsx, useSocket.jsx, useIDE.js
- useIntegrations.js, useRepositories.js

**Presentation `/src/presentation/components/` (NEWER):**
- AppRouter.jsx, ErrorBoundary.jsx, Layout.jsx
- ThemeProvider.jsx, SettingsModal.jsx
- DefinitionsZone.jsx, BuildZone.jsx, LiveTestingZone.jsx
- TestAreaContainer.jsx, Welcome.jsx
- IntegrationGallery.jsx, IntegrationTester.jsx
- And more zone/feature-organized components

**Presentation `/src/presentation/components/ui/` (NEWER):**
- dialog.jsx, button.tsx, card.tsx, badge.tsx, etc.

## The Problem

**Developers must check TWO locations** to find components/hooks:
1. Old location: `/src/components`, `/src/hooks`
2. New location: `/src/presentation/components`, `/src/presentation/hooks`

Some files exist in BOTH places (like Layout.jsx, ThemeProvider.jsx).

---

## âœ… Phase 1: Infrastructure Cleanup (COMPLETED)

**Goal**: Move legacy `/src/services` to proper infrastructure locations

### Actions Taken:
- âœ… Created `/src/infrastructure/http/`, `/websocket/`, `/npm/`
- âœ… Moved `api.js` â†’ `infrastructure/http/api-client.js`
- âœ… Moved `websocket-handlers.js` â†’ `infrastructure/websocket/`
- âœ… Moved `apiModuleService.js` â†’ `infrastructure/npm/npm-registry-client.js`
- âœ… Deleted empty `/src/services` directory

---

## ğŸ“‹ Phase 2: Presentation Layer Consolidation (PENDING APPROVAL)

**Goal**: Single source of truth - everything in `/src/presentation/`

### Strategy: Keep the NEWER files

Since `/src/presentation/` has more recent work (like DefinitionsZone refactor, dialog component), we should:

1. **Merge** any unique old files into `/src/presentation/`
2. **Delete** duplicates in `/src/components` and `/src/hooks`
3. **Organize by feature** within presentation layer

### Proposed Final Structure

```
src/
â”œâ”€â”€ main.jsx                    # Vite entry (stays)
â”œâ”€â”€ container.js               # DI container (stays)
â”œâ”€â”€ lib/                       # Shared utilities (stays)
â”‚   â””â”€â”€ utils.ts
â”‚
â”œâ”€â”€ domain/                    # âœ… Clean - no changes
â”œâ”€â”€ application/              # âœ… Clean - no changes
â”œâ”€â”€ infrastructure/           # âœ… Phase 1 complete
â”‚   â”œâ”€â”€ adapters/            # âœ… Already organized
â”‚   â”œâ”€â”€ http/                # âœ… New - api-client.js
â”‚   â”œâ”€â”€ websocket/           # âœ… New - websocket-handlers.js
â”‚   â””â”€â”€ npm/                 # âœ… New - npm-registry-client.js
â”‚
â”œâ”€â”€ presentation/             # ğŸ¯ CONSOLIDATE HERE
â”‚   â”œâ”€â”€ App.jsx              # ğŸ”„ Move from root
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/              # shadcn components
â”‚   â”‚   â”œâ”€â”€ layout/          # ğŸ”„ Layout, AppRouter, ErrorBoundary
â”‚   â”‚   â”œâ”€â”€ theme/           # ğŸ”„ ThemeProvider
â”‚   â”‚   â”œâ”€â”€ zones/           # ğŸ”„ All zone components
â”‚   â”‚   â”œâ”€â”€ integrations/    # ğŸ”„ Integration-related
â”‚   â”‚   â”œâ”€â”€ common/          # ğŸ”„ Shared components
â”‚   â”‚   â””â”€â”€ index.js         # Public exports
â”‚   â”œâ”€â”€ hooks/               # ğŸ”„ All hooks here
â”‚   â”‚   â”œâ”€â”€ useFrigg.jsx     # âœ… Already here
â”‚   â”‚   â”œâ”€â”€ useSocket.jsx    # ğŸ”„ Move from root
â”‚   â”‚   â”œâ”€â”€ useIDE.js        # ğŸ”„ Move from root
â”‚   â”‚   â”œâ”€â”€ useIntegrations.js
â”‚   â”‚   â””â”€â”€ useRepositories.js
â”‚   â””â”€â”€ pages/               # ğŸ”„ If needed
â”‚       â””â”€â”€ Settings.jsx
â”‚
â””â”€â”€ tests/                   # âœ… Clean - matches structure
```

### Component Organization Plan

**Within `/src/presentation/components/`:**

```
components/
â”œâ”€â”€ ui/                      # shadcn/ui primitives
â”‚   â”œâ”€â”€ button.tsx
â”‚   â”œâ”€â”€ card.tsx
â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”œâ”€â”€ dialog.jsx
â”‚   â”œâ”€â”€ dropdown-menu.tsx
â”‚   â”œâ”€â”€ select.tsx
â”‚   â”œâ”€â”€ input.jsx
â”‚   â””â”€â”€ skeleton.jsx
â”‚
â”œâ”€â”€ layout/                  # App structure
â”‚   â”œâ”€â”€ Layout.jsx
â”‚   â”œâ”€â”€ AppRouter.jsx
â”‚   â””â”€â”€ ErrorBoundary.jsx
â”‚
â”œâ”€â”€ theme/                   # Theming
â”‚   â””â”€â”€ ThemeProvider.jsx
â”‚
â”œâ”€â”€ zones/                   # Zone screens
â”‚   â”œâ”€â”€ DefinitionsZone.jsx
â”‚   â”œâ”€â”€ BuildZone.jsx
â”‚   â”œâ”€â”€ LiveTestingZone.jsx
â”‚   â”œâ”€â”€ TestingZone.jsx
â”‚   â”œâ”€â”€ TestAreaContainer.jsx
â”‚   â”œâ”€â”€ TestAreaWelcome.jsx
â”‚   â””â”€â”€ TestAreaUserSelection.jsx
â”‚
â”œâ”€â”€ integrations/            # Integration features
â”‚   â”œâ”€â”€ IntegrationGallery.jsx
â”‚   â””â”€â”€ IntegrationTester.jsx
â”‚
â””â”€â”€ common/                  # Shared across features
    â”œâ”€â”€ ZoneNavigation.jsx
    â”œâ”€â”€ SearchBar.jsx
    â”œâ”€â”€ LiveLogPanel.jsx
    â”œâ”€â”€ IDESelector.jsx
    â”œâ”€â”€ OpenInIDEButton.jsx
    â”œâ”€â”€ SettingsModal.jsx
    â”œâ”€â”€ ServiceStatus.jsx
    â””â”€â”€ ProjectOverview.jsx
```

---

## Detailed Migration Actions

### A. Analyze for Duplicates
```bash
# Compare files to find duplicates vs unique content
diff /src/components/Layout.jsx /src/presentation/components/Layout.jsx
```

### B. Move Unique Components
For each file in `/src/components/` that doesn't exist in `/src/presentation/`:
- Move to appropriate subdirectory in `/src/presentation/components/`

### C. Organize by Feature
- Create subdirectories: `layout/`, `theme/`, `zones/`, `integrations/`, `common/`
- Move components to logical locations

### D. Consolidate Hooks
- Move all `/src/hooks/*` â†’ `/src/presentation/hooks/`

### E. Move App.jsx
- Move `/src/App.jsx` â†’ `/src/presentation/App.jsx`

### F. Delete Old Directories
- Remove `/src/components/`
- Remove `/src/hooks/`
- Remove `/src/pages/`

### G. Update Import Paths
Find and replace all imports:
```javascript
// Old patterns
from '../components/...'
from '../hooks/...'
from '../../components/...'

// New patterns
from '../presentation/components/...'
from '../presentation/hooks/...'
```

---

## Import Path Examples

### Before:
```javascript
import Layout from '../components/Layout'
import { useFrigg } from '../hooks/useFrigg'
import { Button } from '../components/ui/button'
import api from '../services/api'
```

### After:
```javascript
import Layout from '../presentation/components/layout/Layout'
import { useFrigg } from '../presentation/hooks/useFrigg'
import { Button } from '../presentation/components/ui/button'
import api from '../infrastructure/http/api-client'
```

---

## Testing Strategy

1. **Before Changes**: Run full test suite, note passing tests
2. **After Each Move**: Update imports, run tests
3. **After All Moves**: Full regression test
4. **Build Verification**: `npm run build` must succeed

---

## Risks & Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| Broken imports | High | Update in phases, test after each |
| Merge conflicts | Medium | Coordinate with team, do in PR |
| Test failures | Medium | Fix imports in test files too |
| Build failures | High | Verify Vite config paths |

---

## Success Criteria

- âœ… All code in single DDD-compliant location
- âœ… No duplicate directories
- âœ… All tests passing
- âœ… Build succeeds
- âœ… Clear, navigable structure
- âœ… Updated imports throughout

---

## Next Steps

**AWAITING APPROVAL** before proceeding with Phase 2.

### If Approved:
1. Run comprehensive file comparison to identify duplicates
2. Create detailed file move manifest
3. Execute moves in controlled batches
4. Update imports systematically
5. Run tests after each batch
6. Final verification

### Questions for Review:
1. Proceed with consolidation into `/src/presentation/`?
2. Approve component categorization (layout, zones, integrations, common)?
3. Any components that should be handled differently?

---

**Status**: Phase 1 âœ… Complete | Phase 2 â¸ï¸ Awaiting Approval